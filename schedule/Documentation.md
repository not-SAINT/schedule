# Schedule для RS School

Данный репозиторий содержит возможную реализацию новой версии расписания для приложения [The Rolling Scopes](https://app.rs.school/). Ниже подробно расписаны основные элементы реализации и логика работы расписания.

## Основные компоненты

#### Панель управления - ControlPanel

Панель управления содержит основные элементы управления внешним видом расписания.

- Кнопка смены режима вида распиания меняет иконку на выбранный вид.
- Выбор часового пояса учитывается при любом виде расписания.
- Есть возможность сохранить выбранные данные расписания в файл в формате pdf.
- Hide old events прячет неактуальные события, которые уже прошли.
- Переключение в ролей студент/ментор
- Кнопка добавления нового события, при активной роли **ментор**.

#### Вид расписания: таблица - ScheduleTable

Самый информативный вид расписания. Содержит максимальную информацию о событиях расписания. Имеется возможность настроить показываемые колонки, за исключением основных: **Date % time**, **Type**, **Name**.

###### Данные колонок:

- информация о недавних правках события (lastUpdatedDate). Для обращения внимания на те события, где что-то изменилось с возможного последнего просмотра студентом
- Date % time - дата и время начала события
- Time left - для событий с дедлайном считается количество дней/часов до наступления дедлайна
- Type - тип события, выбирается из подобранного списка основных видов заданий, для которых также определены цвета из палитры antd
  - code jam': 'lime'
  - codewars: 'magenta'
  - cross-check: 'blue'
  - deadline: 'red'
  - interview: 'orange'
  - review: 'yellow'
  - self education: 'cyan'
  - special: 'gold'
  - task: 'green'
  - test: 'volcano'
  - webinar: 'purple'
- Special - дополнительные теги для уточнения типа задания. Для удобства есть подобранный список самых популярных вариантов **'optional', 'live', 'record', 'js', 'node.js', 'react', 'angular', 'css', 'html', 'git', 'markdown', 'task'**. Но ментор может добавить и недостающие при редактировании события.
- Name - Название события и ссылка на страницу события.
- Url - основная ссылка события. Если это ссылка на github или youtube, то иконка будет соответствующая
- Приблизительное время в часах, которое будет длиться событие. Или сколько времени может потребоваться на выполнение задания.
- Organizer - имя на github организатора события
- Place - место проведения события. Заполнено, если событие офлайн и организатор заполнил данные в специальном поле.

#### Вид расписания: список - ScheduleList

Сокращенный вид расписания в виде списка по неделям. Удобен при просмотре расписания с мобильных устройств. Отображаются только основные данные - дата, тип и название события. Так же отменяется количество событий в день.

#### Вид расписания: календарь - ScheduleCalendar

Еще один вид расписания - календарь. Позволяет наглядно оценить ожидающие в ближайшее время события.

#### Страница задания - EventPage

Страница расписания. Отображает всю имеющуюся информацию по заданию. Отличается по виду для ролей студент/ментор.

###### Роль - студент

Для пользователя как студент страница проста - отображаются только те поля, которые содержат данные, заполненные организатором.

###### Роль - ментор

В роли _ментор_ страница превращается в конструктор. Все доступные для заполнения поля отображаются в зависимости от выбранных контролей. И при заполнении их, они станут видны в роли _студент_.

##### Контроли

- Event visible - добавляемое событие можно сделать невидимым для студентов. Сохраняется в поле (isOpen)
- Event offline - если событие оффлан, появляются поля для внесение адреса места и координат события. Без точных координат карта будет указывать на дефолтное место (г. Минск).
- Disable feedback - Доступность поля отзыва для студентов. В роли ментора это поле отображается сохранненные фидбеки по событию (функция в разработке)
- With deadline - если событие с дедлайном, переключатель нужно поставить в верную позицию.
- Update - если обновилось что-то в задании и нужно сохранить изменения
- Create new as copy - для быстрого добавления похожего задания или копии с прошлого набора - можно редактировать старое задание и сразу создать новое.
- Delete - все просто - удаляем событие.

##### Поля для редактирования

- Имя события - все просто, указывается название события.
- Дата начала и конца (при наличии включенного дедлайна). Внимание - необходимо подтверждать выбор каждой даты кнопкой **Ok**.
- Выбор курса - можно выбрать из списка доступных курсов.
- Тип события - выбирается из заранее подобранного списка.
- Специальные теги события - кастомизируем событие уточняющими тегами.
- Organizer - заполняется Имя пользователя на github.
- Hours - оценочная длительность события или необходимое время на выполнение
- Days(Hours) left: - автоматически вычисляемое поле, сколько времени будет до дедлайна для событий с дедлайном.
- Event main link - основвная ссылка на событие. Если это будет ссылка на описание задания с github, то все описание задания будет загружено и отобразится на странице события в секции Event detailed description. Это избавляет от необходимости повторно описывать задание.
- Event description - описание задания. Поддерживается и рекомендуется **markdown**.
- Event detailed description - при основной ссылке события с описанием на github.
- Location - поля для заполнение места оффлайн события. Координаты места вводятся через запятую в формате "широта","долгота".

## Детали реализации

##### Основные используемые библиотеки и технологии

- react
- mobx
- antd
- typescript

##### Вспомогательные используемые библиотеки и технологии

- html2canvas
- jspdf
- react-yandex-maps
- classnames
- moment

### Общие принципы работы

Все данные расписания представляет собой массив объектов событий вида:

```javascript
interface IEvent {
  id: string;
  name: string;
  description: string;
  descriptionUrl: string;
  type: string;
  specialTags?: string;
  timeZone: string;
  dateTime: number;
  place: string;
  comment: string;
  deadline: number;
  hours?: string;
  lastUpdatedDate?: number;
  isOpen: boolean;
  isVisible?: boolean;
  isFeedbackEnabled?: boolean;
  organizerId?: string;
  course?: string;
}
```

При запуске приложения все данные расписаний разных курсов загружаются в стор приложения. Так же при запуске читается локальное хранилище браузера пользователя на предмет наличия настроек приложения. С учетом настроек применяются фильтры для отображения только выбранных событий. Также генерируются события - **deadline** на основании наличия даты дедлайна (deadline > 0). Отдельно события этого типа не хранятся.

Дальнейшая работа приложения зависит от действий пользователя и роли пользователя.

###### Роль - студент

В данном режиме пользователю доступны только настройки внешнего вида приложения. Просмотр событий по выбранным фильтрам. Все изменения настроек сохраняются в стор и локальное хранилище браузера пользователя. Допольнительного обмена данными с сервером нет.

###### Роль - ментор

В этом режиме появляются инструмены для внесения изменений в расписание. Все изменения вносятся со страницы события - **EventPage**. При внесении изменений данные по редактируемому событию обновляются сразу в и на сервер, и в стор, что позволяется не перегружать все данные заново и не отнимать время пользователя.
